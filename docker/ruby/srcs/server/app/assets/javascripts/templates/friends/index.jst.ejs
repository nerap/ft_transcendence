<div id="users-index">
    <table>
        <tr>
            <th colspan="4">Friends</th>
        </tr>
        <% Transcendence.friends.each(function(bob) { %>
        <% Transcendence.users.each(function(model) { %>
        <% if ((bob.escape('user_one_id') == Transcendence.current_user.id)) { %>
        <% if  (bob.escape('user_two_id') == model.escape('id')) { %>
        <% if  (bob.escape('pending') == 'false') { %>
        <tr class="users-list">
            <td style="width:15%;"><img style="width:30px;height:30px;border-radius:50%" src="<%= model.escape('avatar') %>"></td>
            <td onclick='document.location = "/#users/<%= model.escape(`id`) %>"'><%= model.escape('username') %></a></td>
            <td></td>
            <td class="users-action">
                
                <form action="/api/private_rooms" method="post" data-remote="true" id="send-pm"
                    class="<%= model.escape('id') %>">
                    <button type="submit" class="menu-option">send PM</button>
                    <input value="<%= Transcendence.current_user.id %>" type="hidden" name="private_room[user1]">
                    <input value="<%= model.escape('id') %>" type="hidden" name="private_room[user2]">
                    <input type="hidden" name="authenticity_token"
                        value="<%= $(`meta[name='csrf-token']`).attr('content') %>">
                </form>
            </td>
        </tr>
        <% }}} else if ((bob.escape('user_two_id') == Transcendence.current_user.id)) { %>
        <% if (bob.escape('user_one_id') == model.escape('id')) { %>
        <% if  (bob.escape('pending') == 'false') { %>
            <tr class="users-list">
                <td style="width:15%;"><img style="width:30px;height:30px;border-radius:50%" src="<%= model.escape('avatar') %>"></td>
                <td onclick='document.location = "/#users/<%= model.escape(`id`) %>"'><%= model.escape('username') %></a></td>
                <td></td>
                <td class="users-action">
                    
                    <form action="/api/private_rooms" method="post" data-remote="true" id="send-pm"
                        class="<%= model.escape('id') %>">
                        <button type="submit" class="menu-option">send PM</button>
                        <input value="<%= Transcendence.current_user.id %>" type="hidden" name="private_room[user1]">
                        <input value="<%= model.escape('id') %>" type="hidden" name="private_room[user2]">
                        <input type="hidden" name="authenticity_token"
                            value="<%= $(`meta[name='csrf-token']`).attr('content') %>">
                    </form>
                </td>
            </tr>
        <% }}}})}) %>
        <tr>
            <th colspan="4">Current Friends Request</th>
        </tr>
        <% Transcendence.friends.each(function(bob) { %>
        <% Transcendence.users.each(function(model) { %>
        <% if ((bob.escape('user_one_id') == Transcendence.current_user.id)) { %>
        <% if (bob.escape('user_two_id') == model.escape('id')) { %>
        <% if  (bob.escape('pending') == 'true') { %>
            <tr class="users-list">
                <td style="width:15%;"><img style="width:30px;height:30px;border-radius:50%" src="<%= model.escape('avatar') %>"></td>
                <td onclick='document.location = "/#users/<%= model.escape(`id`) %>"'><%= model.escape('username') %></a></td>
                <td class="users-action">
                    <form action="/api/friends/<%= bob.escape('id') %>" method="post" data-remote="true">
                        <input type="hidden" name="_method" value="put">
                        <button type="submit" class="menu-option accept request">Accept Request</button>
                        <input value="<%= model.escape('id') %>" type="hidden" name="user_one_id">
                        <input value="<%= Transcendence.current_user.toJSON().id %>" type="hidden" name="user_two_id">
                        <input value="false" type="hidden" name="pending">
                    </form>
                </td>
                <td class="users-action">
                    
                    <form action="/api/private_rooms" method="post" data-remote="true" id="send-pm"
                        class="<%= model.escape('id') %>">
                        <button type="submit" class="menu-option">send PM</button>
                        <input value="<%= Transcendence.current_user.id %>" type="hidden" name="private_room[user1]">
                        <input value="<%= model.escape('id') %>" type="hidden" name="private_room[user2]">
                        <input type="hidden" name="authenticity_token"
                            value="<%= $(`meta[name='csrf-token']`).attr('content') %>">
                    </form>
                </td>
            </tr>
        <% }}}})}) %>
    </table>
</div>
